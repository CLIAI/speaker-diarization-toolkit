{"test": "001-clear-introductions", "status": "error", "time_sec": 60.09868597984314, "error": "Timeout (>60s)"}
{"test": "002-informal-names", "status": "error", "time_sec": 22.407878160476685, "error": "Exit code 1: ERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 4 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-625', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n   \"_id\": {\\n      \"type\": \"string\"\\n   },\\n\\n   \"timestamp\": \"dateTimeInMillis\",\\n\\n   \"speakers\": [{\\n       \"__v\": 0\\n   },\\n   {\\n       \"__v\": 0\\n   }]\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393844, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': '[YourSchema]'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-51', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"[YourSchema]\"\\n                \\n\\n\\n\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393845, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-544', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$id\": \"/speakers/speakermapping/\",\\n  \"$schema\": \"[ns]:3.0\",\\n  \"title\": \"SpeakerMapping schema\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393850, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</last_exception>\nERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 4 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-625', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n   \"_id\": {\\n      \"type\": \"string\"\\n   },\\n\\n   \"timestamp\": \"dateTimeInMillis\",\\n\\n   \"speakers\": [{\\n       \"__v\": 0\\n   },\\n   {\\n       \"__v\": 0\\n   }]\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393844, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': '[YourSchema]'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-51', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"[YourSchema]\"\\n                \\n\\n\\n\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393845, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-544', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$id\": \"/speakers/speakermapping/\",\\n  \"$schema\": \"[ns]:3.0\",\\n  \"title\": \"SpeakerMapping schema\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393850, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</last_exception>\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 86, in _validate_model_from_json\n    return cls.model_validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~^\n        json_str, context=validation_context, strict=True\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/pydantic/main.py\", line 766, in model_validate_json\n    return cls.__pydantic_validator__.validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        json_data, strict=strict, extra=extra, context=context, by_alias=by_alias, by_name=by_name\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\npydantic_core._pydantic_core.ValidationError: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 273, in retry_sync\n    raise e\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 194, in retry_sync\n    return process_response(  # type: ignore\n        response=response,\n    ...<4 lines>...\n        stream=stream,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/response.py\", line 338, in process_response\n    model = response_model.from_response(\n        response,\n    ...<2 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 245, in from_response\n    return cls.parse_json(completion, validation_context, strict)\n           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 653, in parse_json\n    return _validate_model_from_json(cls, json_content, validation_context, strict)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 101, in _validate_model_from_json\n    raise InstructorValidationError(\n        f\"Failed to validate model {cls.__name__}: {str(e)}\"\n    ) from e\ninstructor.core.exceptions.ValidationError: Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 183, in retry_sync\n    for attempt in max_retries:\n                   ^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 445, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 378, in iter\n    result = action(retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 421, in exc_check\n    raise retry_exc from fut.exception()\ntenacity.RetryError: RetryError[<Future at 0x7f52a7408050 state=finished raised ValidationError>]\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1151, in <module>\n    main()\n    ~~~~^^\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1073, in main\n    speaker_map = handle_llm_detection(args, json_data, detected_speakers)\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 559, in handle_llm_detection\n    detection_result = detect_speakers_llm(\n        provider_spec,\n    ...<3 lines>...\n        args=args\n    )\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 503, in detect_speakers_llm\n    result = client.chat.completions.create(\n        model=model,\n    ...<2 lines>...\n        max_retries=3  # Automatic retry on validation errors\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/client.py\", line 376, in create\n    return self.create_fn(\n           ~~~~~~~~~~~~~~^\n        response_model=response_model,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n        **kwargs,\n        ^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/patch.py\", line 258, in new_create_sync\n    response = retry_sync(\n        func=func,  # type: ignore\n    ...<7 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 276, in retry_sync\n    raise InstructorRetryException(\n    ...<10 lines>...\n    ) from e\ninstructor.core.exceptions.InstructorRetryException: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 4 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'__v': 0}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-625', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n   \"_id\": {\\n      \"type\": \"string\"\\n   },\\n\\n   \"timestamp\": \"dateTimeInMillis\",\\n\\n   \"speakers\": [{\\n       \"__v\": 0\\n   },\\n   {\\n       \"__v\": 0\\n   }]\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393844, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': '[YourSchema]'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-51', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"[YourSchema]\"\\n                \\n\\n\\n\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393845, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-544', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$id\": \"/speakers/speakermapping/\",\\n  \"$schema\": \"[ns]:3.0\",\\n  \"title\": \"SpeakerMapping schema\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393850, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=107, prompt_tokens=2394, total_tokens=2501, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$id': '/speakers/speake...'SpeakerMapping schema'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</last_exception>\n"}
{"test": "003-three-speakers", "status": "error", "time_sec": 60.06283497810364, "error": "Timeout (>60s)"}
{"test": "004-no-names-mentioned", "status": "error", "time_sec": 32.4003050327301, "error": "Exit code 1: ERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0\n  Input should be an object [type=model_type, input_value='Alice Anderson (A)', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\nspeakers.1\n  Input should be an object [type=model_type, input_value='Bob Martinez (B)', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\nreasoning\n  Input should be a valid string [type=string_type, input_value={'A': \"It's not a coincid...s an opinion.\", 'B': ''}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/string_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-523', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    \"Alice Anderson (A)\",\\n    \"Bob Martinez (B)\"\\n  ],\\n  \"confidence\": \"medium\",\\n  \"reasoning\": {\\n    \"A\": \"It\\'s not a coincidence he is here. He has an opinion.\",\\n    \"B\": \"\"\\n  }\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393935, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-987', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$ref\": \"#/$defs/SpeakerMapping\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393936, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-440', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"$ref\": \"#/$defs/SpeakerMapping\"\\n    },\\n    {\"title\": \"A\", \"type\": \"string\"},\\n    {\"title\": \"B\", \"type\": \"string\"},\\n    {\\n      \"$ref\": \"#/dynamic-json/Unknown\"\\n    }\\n  ],\\n  \"confidence\": \"medium\",\\n  \"reasoning\": \"\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393942, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</last_exception>\nERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0\n  Input should be an object [type=model_type, input_value='Alice Anderson (A)', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\nspeakers.1\n  Input should be an object [type=model_type, input_value='Bob Martinez (B)', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\nreasoning\n  Input should be a valid string [type=string_type, input_value={'A': \"It's not a coincid...s an opinion.\", 'B': ''}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/string_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-523', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    \"Alice Anderson (A)\",\\n    \"Bob Martinez (B)\"\\n  ],\\n  \"confidence\": \"medium\",\\n  \"reasoning\": {\\n    \"A\": \"It\\'s not a coincidence he is here. He has an opinion.\",\\n    \"B\": \"\"\\n  }\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393935, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-987', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$ref\": \"#/$defs/SpeakerMapping\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393936, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-440', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"$ref\": \"#/$defs/SpeakerMapping\"\\n    },\\n    {\"title\": \"A\", \"type\": \"string\"},\\n    {\"title\": \"B\", \"type\": \"string\"},\\n    {\\n      \"$ref\": \"#/dynamic-json/Unknown\"\\n    }\\n  ],\\n  \"confidence\": \"medium\",\\n  \"reasoning\": \"\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393942, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</last_exception>\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 86, in _validate_model_from_json\n    return cls.model_validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~^\n        json_str, context=validation_context, strict=True\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/pydantic/main.py\", line 766, in model_validate_json\n    return cls.__pydantic_validator__.validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        json_data, strict=strict, extra=extra, context=context, by_alias=by_alias, by_name=by_name\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\npydantic_core._pydantic_core.ValidationError: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 273, in retry_sync\n    raise e\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 194, in retry_sync\n    return process_response(  # type: ignore\n        response=response,\n    ...<4 lines>...\n        stream=stream,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/response.py\", line 338, in process_response\n    model = response_model.from_response(\n        response,\n    ...<2 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 245, in from_response\n    return cls.parse_json(completion, validation_context, strict)\n           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 653, in parse_json\n    return _validate_model_from_json(cls, json_content, validation_context, strict)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 101, in _validate_model_from_json\n    raise InstructorValidationError(\n        f\"Failed to validate model {cls.__name__}: {str(e)}\"\n    ) from e\ninstructor.core.exceptions.ValidationError: Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 183, in retry_sync\n    for attempt in max_retries:\n                   ^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 445, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 378, in iter\n    result = action(retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 421, in exc_check\n    raise retry_exc from fut.exception()\ntenacity.RetryError: RetryError[<Future at 0x7f7d4ad3ca50 state=finished raised ValidationError>]\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1151, in <module>\n    main()\n    ~~~~^^\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1073, in main\n    speaker_map = handle_llm_detection(args, json_data, detected_speakers)\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 559, in handle_llm_detection\n    detection_result = detect_speakers_llm(\n        provider_spec,\n    ...<3 lines>...\n        args=args\n    )\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 503, in detect_speakers_llm\n    result = client.chat.completions.create(\n        model=model,\n    ...<2 lines>...\n        max_retries=3  # Automatic retry on validation errors\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/client.py\", line 376, in create\n    return self.create_fn(\n           ~~~~~~~~~~~~~~^\n        response_model=response_model,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n        **kwargs,\n        ^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/patch.py\", line 258, in new_create_sync\n    response = retry_sync(\n        func=func,  # type: ignore\n    ...<7 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 276, in retry_sync\n    raise InstructorRetryException(\n    ...<10 lines>...\n    ) from e\ninstructor.core.exceptions.InstructorRetryException: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0\n  Input should be an object [type=model_type, input_value='Alice Anderson (A)', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\nspeakers.1\n  Input should be an object [type=model_type, input_value='Bob Martinez (B)', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\nreasoning\n  Input should be a valid string [type=string_type, input_value={'A': \"It's not a coincid...s an opinion.\", 'B': ''}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/string_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-523', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    \"Alice Anderson (A)\",\\n    \"Bob Martinez (B)\"\\n  ],\\n  \"confidence\": \"medium\",\\n  \"reasoning\": {\\n    \"A\": \"It\\'s not a coincidence he is here. He has an opinion.\",\\n    \"B\": \"\"\\n  }\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393935, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-987', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$ref\": \"#/$defs/SpeakerMapping\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393936, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-440', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"$ref\": \"#/$defs/SpeakerMapping\"\\n    },\\n    {\"title\": \"A\", \"type\": \"string\"},\\n    {\"title\": \"B\", \"type\": \"string\"},\\n    {\\n      \"$ref\": \"#/dynamic-json/Unknown\"\\n    }\\n  ],\\n  \"confidence\": \"medium\",\\n  \"reasoning\": \"\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393942, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=168, prompt_tokens=2319, total_tokens=2487, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 8 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'title': 'A', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_label\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.2.speaker_name\n  Field required [type=missing, input_value={'title': 'B', 'type': 'string'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.3.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/dynamic-json/Unknown'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</last_exception>\n"}
{"test": "005-partial-names", "status": "error", "time_sec": 13.421891212463379, "error": "Exit code 1: ERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': 'https://sche...me': 'DetectedSpeakers'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-848', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"https://schema.com/speaker\",\\n  \"title\": \"Detected Speaker Mappings\",\\n  \"name\": \"DetectedSpeakers\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393948, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 5 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'description': 'B'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'description': 'B'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'description': 'A'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'description': 'A'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nconfidence\n  Input should be a valid string [type=string_type, input_value=0.15, input_type=float]\n    For further information visit https://errors.pydantic.dev/2.12/v/string_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-859', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"description\": \"B\"\\n    },\\n    {\\n      \"description\": \"A\"\\n    }\\n  ],\\n  \"confidence\": 0.15,\\n  \"reasoning\": \"We are not sure about the speaker\\'s identity of B and A yet.\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393953, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-637', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": {\\n    \"$ref\": \"#/$defs/SpeakerMapping\"\\n  },\\n  \"confidence\": \"medium\",\\n  \"reasoning\": \"\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393956, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n</last_exception>\nERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': 'https://sche...me': 'DetectedSpeakers'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-848', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"https://schema.com/speaker\",\\n  \"title\": \"Detected Speaker Mappings\",\\n  \"name\": \"DetectedSpeakers\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393948, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 5 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'description': 'B'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'description': 'B'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'description': 'A'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'description': 'A'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nconfidence\n  Input should be a valid string [type=string_type, input_value=0.15, input_type=float]\n    For further information visit https://errors.pydantic.dev/2.12/v/string_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-859', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"description\": \"B\"\\n    },\\n    {\\n      \"description\": \"A\"\\n    }\\n  ],\\n  \"confidence\": 0.15,\\n  \"reasoning\": \"We are not sure about the speaker\\'s identity of B and A yet.\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393953, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-637', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": {\\n    \"$ref\": \"#/$defs/SpeakerMapping\"\\n  },\\n  \"confidence\": \"medium\",\\n  \"reasoning\": \"\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393956, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n</last_exception>\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 86, in _validate_model_from_json\n    return cls.model_validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~^\n        json_str, context=validation_context, strict=True\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/pydantic/main.py\", line 766, in model_validate_json\n    return cls.__pydantic_validator__.validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        json_data, strict=strict, extra=extra, context=context, by_alias=by_alias, by_name=by_name\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\npydantic_core._pydantic_core.ValidationError: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 273, in retry_sync\n    raise e\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 194, in retry_sync\n    return process_response(  # type: ignore\n        response=response,\n    ...<4 lines>...\n        stream=stream,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/response.py\", line 338, in process_response\n    model = response_model.from_response(\n        response,\n    ...<2 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 245, in from_response\n    return cls.parse_json(completion, validation_context, strict)\n           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 653, in parse_json\n    return _validate_model_from_json(cls, json_content, validation_context, strict)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 101, in _validate_model_from_json\n    raise InstructorValidationError(\n        f\"Failed to validate model {cls.__name__}: {str(e)}\"\n    ) from e\ninstructor.core.exceptions.ValidationError: Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 183, in retry_sync\n    for attempt in max_retries:\n                   ^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 445, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 378, in iter\n    result = action(retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 421, in exc_check\n    raise retry_exc from fut.exception()\ntenacity.RetryError: RetryError[<Future at 0x7f051d1f0050 state=finished raised ValidationError>]\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1151, in <module>\n    main()\n    ~~~~^^\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1073, in main\n    speaker_map = handle_llm_detection(args, json_data, detected_speakers)\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 559, in handle_llm_detection\n    detection_result = detect_speakers_llm(\n        provider_spec,\n    ...<3 lines>...\n        args=args\n    )\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 503, in detect_speakers_llm\n    result = client.chat.completions.create(\n        model=model,\n    ...<2 lines>...\n        max_retries=3  # Automatic retry on validation errors\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/client.py\", line 376, in create\n    return self.create_fn(\n           ~~~~~~~~~~~~~~^\n        response_model=response_model,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n        **kwargs,\n        ^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/patch.py\", line 258, in new_create_sync\n    response = retry_sync(\n        func=func,  # type: ignore\n    ...<7 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 276, in retry_sync\n    raise InstructorRetryException(\n    ...<10 lines>...\n    ) from e\ninstructor.core.exceptions.InstructorRetryException: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': 'https://sche...me': 'DetectedSpeakers'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-848', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"https://schema.com/speaker\",\\n  \"title\": \"Detected Speaker Mappings\",\\n  \"name\": \"DetectedSpeakers\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393948, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 5 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'description': 'B'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'description': 'B'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'description': 'A'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'description': 'A'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nconfidence\n  Input should be a valid string [type=string_type, input_value=0.15, input_type=float]\n    For further information visit https://errors.pydantic.dev/2.12/v/string_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-859', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"description\": \"B\"\\n    },\\n    {\\n      \"description\": \"A\"\\n    }\\n  ],\\n  \"confidence\": 0.15,\\n  \"reasoning\": \"We are not sure about the speaker\\'s identity of B and A yet.\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393953, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-637', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": {\\n    \"$ref\": \"#/$defs/SpeakerMapping\"\\n  },\\n  \"confidence\": \"medium\",\\n  \"reasoning\": \"\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393956, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=143, prompt_tokens=2397, total_tokens=2540, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Input should be a valid array [type=list_type, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/list_type\n</last_exception>\n"}
{"test": "006-ambiguous-context", "status": "error", "time_sec": 34.13741707801819, "error": "Exit code 1: ERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 4 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-99', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"$ref\": \"#/$defs/SpeakerMapping\"\\n    },\\n    {\\n      \"$ref\": \"#/$defs/\"\\n    }\\n  ],\\n  \"confidence\": \"true\",\\n  \"reasoning\": \"[] \"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393963, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': '[YOUR_SCHEMA...R_REFERENCE_TO_SCHEMA]'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-346', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"[YOUR_SCHEMA_1]\",\\n  \"type\": \"object\",\\n  \"$id\": \"[DATA_TO_PROCESS_1]\",\\n  \"description\": \"\",\\n  \"specifications\": {\\n    \"api\": [\\n      {\\n        \"functionName\": \"speakerIdentification\",\\n        \"parameters\": {\\n          \"timestampOffset\": null,\\n          \"messageContent\": \"A string representing the conversation transcript\",\\n          \"required\": [],\\n          \"properties\": {},\\n          \"type\": \"object\"\\n        }\\n      }\\n    ]\\n  },\\n  \"$metadata\": {\\n    \"title\": [\\n       \"Speaker Identification for LLM Conversation Transcripts\",\\n        \"Description: This function identifies participants in a dialogue transcript and returns them as an object with their associated information including title, speakers, confidence, reasoning, and name.\"\\n      ],\\n    \"documentation\": [\\n      \"https:\\\\/\\\\/www.my_domain.com\\\\/blog/2019\\\\/\\'speaker-identification\\'\\\\/SpeakerIdentification-for-LLM-Conversation-Transcripts\\\\/\",\\n      \"Version: 2019\"\\n    ]\\n  },\\n  \"$ref\": \"[YOUR_REFERENCE_TO_SCHEMA]\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393986, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-831', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n     \"speakers\": [\\n          {\\n             \"$ref\": \"#/$defs/SpeakerMapping\"\\n         }, 4\\n\\n]\\n  }', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393990, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n</last_exception>\nERROR: LLM detection failed: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 4 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-99', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"$ref\": \"#/$defs/SpeakerMapping\"\\n    },\\n    {\\n      \"$ref\": \"#/$defs/\"\\n    }\\n  ],\\n  \"confidence\": \"true\",\\n  \"reasoning\": \"[] \"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393963, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': '[YOUR_SCHEMA...R_REFERENCE_TO_SCHEMA]'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-346', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"[YOUR_SCHEMA_1]\",\\n  \"type\": \"object\",\\n  \"$id\": \"[DATA_TO_PROCESS_1]\",\\n  \"description\": \"\",\\n  \"specifications\": {\\n    \"api\": [\\n      {\\n        \"functionName\": \"speakerIdentification\",\\n        \"parameters\": {\\n          \"timestampOffset\": null,\\n          \"messageContent\": \"A string representing the conversation transcript\",\\n          \"required\": [],\\n          \"properties\": {},\\n          \"type\": \"object\"\\n        }\\n      }\\n    ]\\n  },\\n  \"$metadata\": {\\n    \"title\": [\\n       \"Speaker Identification for LLM Conversation Transcripts\",\\n        \"Description: This function identifies participants in a dialogue transcript and returns them as an object with their associated information including title, speakers, confidence, reasoning, and name.\"\\n      ],\\n    \"documentation\": [\\n      \"https:\\\\/\\\\/www.my_domain.com\\\\/blog/2019\\\\/\\'speaker-identification\\'\\\\/SpeakerIdentification-for-LLM-Conversation-Transcripts\\\\/\",\\n      \"Version: 2019\"\\n    ]\\n  },\\n  \"$ref\": \"[YOUR_REFERENCE_TO_SCHEMA]\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393986, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-831', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n     \"speakers\": [\\n          {\\n             \"$ref\": \"#/$defs/SpeakerMapping\"\\n         }, 4\\n\\n]\\n  }', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393990, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n</last_exception>\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 86, in _validate_model_from_json\n    return cls.model_validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~^\n        json_str, context=validation_context, strict=True\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/pydantic/main.py\", line 766, in model_validate_json\n    return cls.__pydantic_validator__.validate_json(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        json_data, strict=strict, extra=extra, context=context, by_alias=by_alias, by_name=by_name\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\npydantic_core._pydantic_core.ValidationError: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 273, in retry_sync\n    raise e\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 194, in retry_sync\n    return process_response(  # type: ignore\n        response=response,\n    ...<4 lines>...\n        stream=stream,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/response.py\", line 338, in process_response\n    model = response_model.from_response(\n        response,\n    ...<2 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 245, in from_response\n    return cls.parse_json(completion, validation_context, strict)\n           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 653, in parse_json\n    return _validate_model_from_json(cls, json_content, validation_context, strict)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/processing/function_calls.py\", line 101, in _validate_model_from_json\n    raise InstructorValidationError(\n        f\"Failed to validate model {cls.__name__}: {str(e)}\"\n    ) from e\ninstructor.core.exceptions.ValidationError: Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 183, in retry_sync\n    for attempt in max_retries:\n                   ^^^^^^^^^^^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 445, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 378, in iter\n    result = action(retry_state)\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/tenacity/__init__.py\", line 421, in exc_check\n    raise retry_exc from fut.exception()\ntenacity.RetryError: RetryError[<Future at 0x7fbc4e038050 state=finished raised ValidationError>]\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1151, in <module>\n    main()\n    ~~~~^^\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 1073, in main\n    speaker_map = handle_llm_detection(args, json_data, detected_speakers)\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 559, in handle_llm_detection\n    detection_result = detect_speakers_llm(\n        provider_spec,\n    ...<3 lines>...\n        args=args\n    )\n  File \"/home/gw-t490/github/CLIAI/handy_scripts_CLIAI/evals/speaker_mapper/../../stt_assemblyai_speaker_mapper.py\", line 503, in detect_speakers_llm\n    result = client.chat.completions.create(\n        model=model,\n    ...<2 lines>...\n        max_retries=3  # Automatic retry on validation errors\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/client.py\", line 376, in create\n    return self.create_fn(\n           ~~~~~~~~~~~~~~^\n        response_model=response_model,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n        **kwargs,\n        ^^^^^^^^^\n    )\n    ^\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/patch.py\", line 258, in new_create_sync\n    response = retry_sync(\n        func=func,  # type: ignore\n    ...<7 lines>...\n        mode=mode,\n    )\n  File \"/home/gw-t490/.cache/uv/environments-v2/stt-assemblyai-speaker-mapper-d31c6980fb1e95ed/lib/python3.13/site-packages/instructor/core/retry.py\", line 276, in retry_sync\n    raise InstructorRetryException(\n    ...<10 lines>...\n    ) from e\ninstructor.core.exceptions.InstructorRetryException: <failed_attempts>\n\n<generation number=\"1\">\n<exception>\n    Failed to validate model SpeakerDetection: 4 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-99', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"speakers\": [\\n    {\\n      \"$ref\": \"#/$defs/SpeakerMapping\"\\n    },\\n    {\\n      \"$ref\": \"#/$defs/\"\\n    }\\n  ],\\n  \"confidence\": \"true\",\\n  \"reasoning\": \"[] \"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393963, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"2\">\n<exception>\n    Failed to validate model SpeakerDetection: 1 validation error for SpeakerDetection\nspeakers\n  Field required [type=missing, input_value={'$schema': '[YOUR_SCHEMA...R_REFERENCE_TO_SCHEMA]'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-346', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n  \"$schema\": \"[YOUR_SCHEMA_1]\",\\n  \"type\": \"object\",\\n  \"$id\": \"[DATA_TO_PROCESS_1]\",\\n  \"description\": \"\",\\n  \"specifications\": {\\n    \"api\": [\\n      {\\n        \"functionName\": \"speakerIdentification\",\\n        \"parameters\": {\\n          \"timestampOffset\": null,\\n          \"messageContent\": \"A string representing the conversation transcript\",\\n          \"required\": [],\\n          \"properties\": {},\\n          \"type\": \"object\"\\n        }\\n      }\\n    ]\\n  },\\n  \"$metadata\": {\\n    \"title\": [\\n       \"Speaker Identification for LLM Conversation Transcripts\",\\n        \"Description: This function identifies participants in a dialogue transcript and returns them as an object with their associated information including title, speakers, confidence, reasoning, and name.\"\\n      ],\\n    \"documentation\": [\\n      \"https:\\\\/\\\\/www.my_domain.com\\\\/blog/2019\\\\/\\'speaker-identification\\'\\\\/SpeakerIdentification-for-LLM-Conversation-Transcripts\\\\/\",\\n      \"Version: 2019\"\\n    ]\\n  },\\n  \"$ref\": \"[YOUR_REFERENCE_TO_SCHEMA]\"\\n}', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393986, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n<generation number=\"3\">\n<exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n</exception>\n<completion>\n    ChatCompletion(id='chatcmpl-831', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='{\\n     \"speakers\": [\\n          {\\n             \"$ref\": \"#/$defs/SpeakerMapping\"\\n         }, 4\\n\\n]\\n  }', refusal=None, role='assistant', annotations=None, audio=None, function_call=None, tool_calls=None))], created=1760393990, model='smollm2:360m', object='chat.completion', service_tier=None, system_fingerprint='fp_ollama', usage=CompletionUsage(completion_tokens=354, prompt_tokens=2373, total_tokens=2727, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=None, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=None), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))\n</completion>\n</generation>\n\n</failed_attempts>\n\n<last_exception>\n    Failed to validate model SpeakerDetection: 3 validation errors for SpeakerDetection\nspeakers.0.speaker_label\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.0.speaker_name\n  Field required [type=missing, input_value={'$ref': '#/$defs/SpeakerMapping'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.12/v/missing\nspeakers.1\n  Input should be an object [type=model_type, input_value=4, input_type=int]\n    For further information visit https://errors.pydantic.dev/2.12/v/model_type\n</last_exception>\n"}
{"test": "007-four-speakers", "status": "error", "time_sec": 60.063411235809326, "error": "Timeout (>60s)"}
{"summary": {"total": 7, "passed": 0, "failed": 0, "errors": 7, "pass_rate": 0.0, "avg_accuracy": 0, "avg_time_sec": 40.37, "total_time_sec": 282.59}}
